### 🔹 `pg_ctl stop -m fast`（快速停止）

*   **立即断开所有客户端连接**。
*   **正在进行的事务会被回滚**。
*   **会进行一次检查点（checkpoint）**，确保数据一致性。
*   关闭过程是“正常的关闭”，下次启动时只需最小限度的恢复操作。

👉 通常推荐使用这种方式来关闭数据库，既快速又安全。



### 🔹 `pg_ctl stop -m immediate`（立即停止）

*   **直接终止后台进程**，相当于强行 kill 掉 postgres 进程。
*   **不会执行检查点**。
*   所有事务都立刻中断。
*   下次启动时会触发 **崩溃恢复（crash recovery）**，需要依靠 WAL 日志进行回放，启动会更慢。

👉 相当于“拔电源”的做法，只能在数据库无法正常关闭时作为**最后手段**使用。



### ✅ 总结对比

| 模式 | 行为 | 适用场景 |
| --- | --- | --- |
| **fast** | 断开连接 + 回滚事务 + 执行检查点，安全快速关闭 | 日常使用 |
| **immediate** | 直接 kill 进程，不执行检查点，下次启动需做崩溃恢复 | 紧急情况 |



简单记忆：

*   **fast = 快速但安全**
*   **immediate = 强制 kill，等同于崩溃**


